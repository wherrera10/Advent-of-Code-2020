input = """
Tile 2129:
.#.#..##..
..#..#....
..........
...###..#.
..#.......
#...#...##
#...#.....
#...#.#...
##.......#
.#..###..#

Tile 2861:
##..##.###
#..#......
.#...#....
#.#....#..
....#.#...
.#......##
#.#..#.#.#
........#.
#.........
..#..###.#

Tile 1789:
#...##..##
...#.##...
#.....#...
....#.....
.#...#....
.....#..##
....#..#.#
.....##..#
.........#
##.#...##.

Tile 2371:
..##.##..#
..#.##....
..........
#..##..#..
....##.#..
....#...#.
...#.##...
...##....#
#..#.#....
##.#.##..#

Tile 3613:
#######..#
#........#
.#......##
#...#.....
...##....#
#.#..#..#.
##.......#
#.#.#..#.#
.##..#..#.
##..######

Tile 1697:
.##..#####
........#.
..##......
....#.#..#
#...#.#..#
#..##..#.#
#......#.#
..#......#
#..#.....#
.#.#.#.#..

Tile 1607:
#.#...#..#
#.#.##...#
.#..#.....
##........
#.........
.....#.###
...#...#.#
#......#.#
........#.
##.#.####.

Tile 1657:
#.#.#....#
..####...#
##........
.#.....#..
#..#......
##.##...#.
.##..#..##
#.#.##...#
#....##...
...#...#..

Tile 1249:
.#.#......
.#.......#
#..#....##
#..###.#.#
##.....#..
.##......#
..........
.##...##..
..#....#.#
.#..####.#

Tile 1223:
#....#..#.
..#....#.#
..#.#..#.#
#.#.....#.
#........#
#....#..#.
#.....#...
#.........
####......
#...###.##

Tile 1373:
.....##.##
#..#....##
#.........
##...#....
.#.......#
...##.....
..#......#
#.......#.
..........
##.##.#.#.

Tile 1109:
.#.###....
#........#
#.#..#...#
.........#
#........#
.#..#....#
#.##......
....#.##.#
...###..#.
...#.##.##

Tile 3607:
##.#...###
#.......#.
.#.##.#...
....##..#.
..#...#..#
.....#..##
.....###..
##..#.#...
.##.......
.#...###..

Tile 2309:
.##.#...##
..#..#...#
##...#.#..
#........#
#........#
.#..#.....
.....#.#..
#...#....#
........##
##...##.##

Tile 3041:
.#..#.####
#.#.....##
..#....#.#
#.......##
#......#.#
.#.......#
##...#....
##..#...##
##...#...#
..#.##....

Tile 1427:
.##..###..
.....###.#
#.........
.........#
#.#..##..#
###..##.#.
##....##..
#........#
....#....#
####..##.#

Tile 3461:
.#.####...
..........
.......#.#
........#.
#.........
..#......#
#....#...#
.#.......#
......#...
..###.....

Tile 1327:
#..#####..
#....#....
#..#......
....##..##
.......#.#
##....#...
###.......
........#.
..##.....#
..#..#.#..

Tile 1289:
.#.##..##.
#..#......
.......#.#
...#.#....
#.##...#.#
##..#...##
##.......#
...#....#.
####..#...
#...#.###.

Tile 2857:
##.#####.#
.........#
.#.##..#..
###..#....
##....#...
...#.#.#.#
#.......#.
##.##....#
#...##.##.
###.##..##

Tile 3823:
#.........
..#.......
...#......
#.........
#...##.#.#
..##.#....
..##.....#
.#..#.#...
#...#....#
.###...#..

Tile 3557:
.##.#.##.#
#..#.#..##
....###.##
##...#..#.
#...#.#..#
#...###..#
#...#..#..
.##.#..#..
###..#....
##..##..#.

Tile 2713:
...##.###.
#.........
.........#
..##...#..
.....#...#
.......##.
...#......
#.#....#..
#.#.......
.#....###.

Tile 1213:
.##..#.##.
#.#.......
........#.
.....##...
....#....#
#....#.###
...##....#
#.#...#..#
#...##...#
.###..##..

Tile 2341:
.#######..
..#....##.
####...#..
.###.....#
#....#..#.
...#...##.
....##...#
#........#
#..#.....#
.#.#..##..

Tile 3467:
....#..##.
....##.#.#
....##...#
##..###...
...#......
#......#..
#.....#..#
....###..#
#....#....
..#.#.#.#.

Tile 1583:
.#.#.#.#.#
.#.#......
#...#.....
...###.#.#
##........
#..#...#.#
#...#....#
....#.....
#....##...
##..######

Tile 1087:
###.#.#..#
#.#.......
#.#......#
##........
.#.#...#.#
#........#
#.#......#
#......##.
.....#....
.##.#.#.##

Tile 3691:
###.#.....
#.#..#...#
.....##..#
#..#.##...
#........#
#.##.....#
.##.#....#
#........#
##......#.
#.##.###..

Tile 3881:
#.#..##...
#..#.....#
..#.#....#
###......#
#..##....#
....#..#.#
##....#.#.
.#.#....##
###.......
#...##.##.

Tile 1033:
...#.##..#
#.##...#..
......#.#.
..####....
....#..#..
#........#
..#..#...#
...#......
##...#.#.#
##.##.####

Tile 3361:
..##.#....
.........#
..##......
....##...#
##....#..#
...#....#.
.##......#
###......#
..#..#...#
.....##..#

Tile 1459:
#.#.##..#.
........#.
...#...#..
.#........
..#.#....#
#...###..#
#.#..##..#
#..#.#...#
...##.....
##.#...##.

Tile 3833:
.#..####.#
..#.#....#
###.####.#
..#..#..##
#.........
#.......#.
..........
......#.#.
#....#....
##......#.

Tile 3779:
..###...##
......#...
.....###..
####.....#
.......#.#
....#.#...
....##.#..
#...#....#
#...#....#
.#..#.....

Tile 2333:
...###.###
#..#......
.........#
#.#......#
#..#..#.#.
###....###
#.#.......
#.....#..#
.......#.#
.#..#...##

Tile 2099:
#..##.#..#
#.........
#........#
..#......#
#.........
#..##.##.#
#..##...#.
...###....
....#.#..#
.....#.##.

Tile 1801:
####.###.#
#..#.....#
#......#.#
..........
.....#..#.
..#...#...
.........#
#...#.....
.#.....#.#
#....##.#.

Tile 2237:
##..##.#..
..#.#..#..
...#..#..#
.....#...#
..#....#.#
...##.##..
#......#..
......####
......###.
.#.##.###.

Tile 2357:
...#.###.#
#..#.#...#
#..#..#...
##......#.
..........
#..##....#
..#..##...
#....#...#
#....#....
.#..#..##.

Tile 1597:
..#.###..#
...#......
#...#.....
...#.#.#..
#....#....
#....#....
.....#.#..
#..#..#.#.
#....#...#
.#...##.##

Tile 3229:
#.......##
#.........
#...###..#
..#.#.....
..........
.#.#.....#
#.#..#.###
.......#..
#...#....#
..#.##.###

Tile 2609:
...#.#.##.
..##......
#.#......#
#....#.#.#
#...#.#...
..##...##.
#..#...#..
.#.#.#..##
#.##.....#
...###....

Tile 2719:
#..#.#.###
##.#....#.
......##.#
.##.#.....
.##...##.#
###...#...
.........#
..........
....##....
######.##.

Tile 3407:
..#.######
.........#
#......#.#
#........#
#.........
#.#......#
#.....#..#
.........#
.#.#......
..###.###.

Tile 1063:
.####.###.
#..#.....#
#..#...#.#
.........#
#......#..
#.........
..#..#...#
.#..#.#..#
...#.##...
#.##.....#

Tile 2111:
.#.#######
..##...#..
.#.#......
...##.....
##.......#
.##...#..#
#........#
#.#.#.#...
#.........
#.#..####.

Tile 1499:
..#..###.#
.#.....#.#
.........#
##....#.#.
..#.##..##
##.#..#..#
....##....
........#.
#.........
.###.##.##

Tile 1283:
#...##..#.
......#.##
.....##...
..#....#..
......#..#
#........#
....#....#
##........
.#......##
.#..##.#..

Tile 3499:
...#.#.#.#
..#......#
#...##...#
#...#....#
...###.#.#
.#.#..#..#
#.....##..
..#.#..#.#
.#.##..#..
##....#...

Tile 2251:
##.##.....
###..#...#
#.....#...
....#..#..
#..#..#...
........#.
......#...
#.#.#....#
#....#....
#.##.#...#

Tile 2819:
..#...#..#
.#.#.##...
.#..##....
##...#.#..
##.......#
........#.
#..#..#...
.#...#.#.#
......#...
...###...#

Tile 2711:
.......#.#
#..#.##..#
....#.#...
..........
..........
#....#....
#..##....#
#....#....
#.........
.#########

Tile 2423:
#....####.
....#.#..#
....#.####
..#.....##
##.......#
##..#.#..#
...#.....#
#.....#...
.##...#..#
#.##.#....

Tile 3907:
..#..#.#..
##.......#
....##....
#....##..#
.......#..
#....#.#..
##.......#
###....##.
#....#..#.
#..##.#...

Tile 3929:
##.##.###.
...#..#.##
....#.....
#.#..#...#
.#......##
.....#....
....#..##.
.#........
..##.....#
.#..#.....

Tile 1879:
..#.###..#
##...#.#..
#........#
##.......#
#........#
....#...#.
#.......##
#..##....#
........##
##.###.###

Tile 1951:
#...###.#.
#..###...#
#......#..
#.#.....#.
#.##.....#
...###....
.#.#....#.
.........#
.#.#......
.##.#.#..#

Tile 2503:
#.#..##...
#.....##.#
#.........
..###...#.
#.#.#....#
###...#...
.##..#...#
...#......
###..#...#
.....#.#..

Tile 3539:
.####.#.##
....##.#.#
#.......#.
.#.#.#..##
.#.#.....#
#...##..#.
...#.#....
...#...##.
##..#.##.#
.#####..#.

Tile 2039:
.##.#...##
....#....#
...#.....#
.......#.#
..##..#...
.........#
##........
#......#..
.#...#....
.##.#..##.

Tile 2243:
..####....
#....#...#
#........#
#...##...#
#.#...#...
#.........
##..#....#
...#......
#........#
.##....#.#

Tile 1103:
##..###.#.
...#..#..#
#...#.....
...#.#...#
.##..#..##
....#.#..#
#..##....#
#.......#.
#...#....#
.#..#..###

Tile 2693:
.#..##...#
#....#...#
..#.......
.........#
#.####.#..
#.....#...
....#..##.
......#..#
....#..#..
....##...#

Tile 2971:
#..#..##..
#.........
#...#.....
...#......
...#..#..#
.#.......#
#...#..#..
#.##.....#
......#...
.#.####...

Tile 1483:
.##.###..#
#......##.
..#.#.....
#...#..#.#
#..#....##
..##.##.##
.#.#..####
#.....##..
..#.......
..###..##.

Tile 3583:
###.#....#
.....#....
#...###...
#.....#...
......#.##
..........
.........#
##........
....#.#...
.##.##.#..

Tile 2179:
##.....###
....#.....
#.........
##.....#.#
##.......#
.####.....
#...#.#.#.
...#......
.....#....
....#...##

Tile 1567:
#.######..
###.......
..........
.....#.#..
#..#......
.......#.#
........#.
......#.#.
..........
#..#.####.

Tile 3851:
..###..#.#
.##..#..##
#..###.#..
..##..##.#
###.......
.......#..
#.###.#...
#..#....#.
##.##..#.#
##..####.#

Tile 3343:
##.##...##
....#.....
.......#.#
.....#..#.
#...##.#.#
.......##.
#..#.....#
...#......
.........#
.####.##.#

Tile 3319:
#.#.......
..#....#..
....#...#.
.##......#
.....#....
..#.#.....
#...#...#.
#.#...#..#
###.......
#..##.....

Tile 3947:
.#..#..##.
.##.......
##....#...
.#.#......
..#.#.#..#
.....#...#
......#...
..#.#.####
#...#....#
.#.##..#..

Tile 1559:
.....#...#
##....#...
##......##
#.###..###
##..#.....
##.......#
...###.#.#
#.......#.
..##....#.
##..####.#

Tile 2063:
#.#..#.#..
...#.....#
#........#
.#.#....##
#.#.#....#
......#..#
#..##....#
.##...#...
##...#....
.#.##..##.

Tile 3163:
..##.#.##.
....#.#...
#.........
#..###...#
#..#..#..#
#..#....##
#......#.#
.....#....
#..#....#.
##..#.##.#

Tile 3659:
.#....#..#
##.......#
#.....#...
#..#.....#
#.#......#
###.#..###
##...#####
.#....##.#
#.#....#..
####.##.#.

Tile 1229:
....###...
...#.#...#
....#....#
.......###
......#.##
#....###..
#......#.#
......#..#
#..#...#..
.......#..

Tile 1433:
.###.....#
....#.#...
##....#..#
.....#.#.#
..........
.##...#..#
#.#..#....
#....##...
.....###.#
....####.#

Tile 1487:
.##.###.##
####..#.##
###..#....
....#.....
..........
##.#...#.#
..#...#..#
#.#.......
.##..#...#
...##.#...

Tile 2939:
.#....###.
##........
##........
##......#.
.#........
.#.##..#..
.#.#.##..#
..........
...#......
#..###.##.

Tile 2753:
###.#...##
##....#...
##.#.#...#
#.....#..#
.........#
##.......#
#........#
#.#.#..#..
#....#..##
.###..##.#

Tile 1429:
..##....#.
......#..#
#.#..##...
#.......##
#.........
#.....#...
....#.#.##
#...#.....
#......#..
...#.#.#..

Tile 3371:
.#........
.........#
#........#
#.###.#..#
....###..#
.##.##.#..
###.##....
##....#.#.
...##....#
#.#.##.##.

Tile 1973:
..##.#....
...#...#..
.###..#.##
.#.#.....#
#...#.....
..#..#.#.#
##...#.#..
....#..#.#
#.##...#.#
#.####.#..

Tile 3967:
..#..#.##.
#..#..#...
##..#....#
.##.....#.
...#.....#
..#.#....#
........##
#..##..#..
..........
#..##.###.

Tile 2207:
.##...###.
#...#.##..
....#..#.#
..........
##..#.....
..........
#..#.....#
#.....#..#
.........#
#.#..#.#..

Tile 1669:
....#..#.#
...#...#.#
#..#...#..
#.....#..#
#.##.#....
...#....##
#.........
#.........
.........#
###....#.#

Tile 1361:
#....#..##
.......#.#
#...#.#...
.........#
##..#.#.##
.........#
..#..##...
#....#....
....##....
..#..#.###

Tile 2851:
##..#...##
##.#....#.
##.....###
.#.##.....
...##....#
#...##...#
##..#...##
.......#.#
#.#...#.#.
.##.##....

Tile 1217:
...#.#.#..
#.#..#.#.#
#......#..
.#..##..#.
#..#......
##..#....#
#..##...#.
#..#...#..
.#.....#.#
#..##.##.#

Tile 3631:
......####
#...#.#.##
......##..
...#..#.#.
#......#.#
.#.#...#.#
#...##...#
#......#..
#......#..
...##..#..

Tile 3571:
#....#.#..
#.....#...
......#.#.
..........
#...#.....
.#....#...
..##.###..
#.##....##
#.........
.......##.

Tile 3067:
##........
.........#
#...#.....
...#....##
#........#
##.......#
#.....#..#
#.........
...#..#...
##.....#.#

Tile 2069:
.#.##.....
#......###
..#.##...#
.##..#....
#.....###.
#.#...##.#
........#.
#.........
..........
..#.#.##..

Tile 2551:
##.#.##...
....##..#.
......#...
#.........
..#..#...#
......#...
...#.##.##
...#...#..
#......#..
#..#.###..

Tile 1747:
##.#......
#....#.#.#
....#....#
....#..#..
#..#...#.#
#....#....
#.........
#.#...##..
.......#..
..######.#

Tile 2017:
.#####....
##.##.##.#
.........#
#.##.....#
#.....#.#.
......#.##
#.##......
#.....#..#
....#.#...
.#.#.###..

Tile 2789:
..#.....##
##.....#.#
#.....##..
#.#...#...
.......#.#
.#.#...#.#
.#.......#
##.....#.#
#.#..##...
#######...

Tile 2477:
####.##.##
.##.......
#.#....#..
#.#....#..
#..##..#.#
##...##...
#....#....
......#...
..........
#####..##.

Tile 3299:
#.##..####
.......#.#
#.###..#.#
#.#..##.#.
##.#..##..
.......#..
#.........
....#.#...
#..##.#...
.##...#..#

Tile 3169:
#...##.###
#.....##.#
#.#.#..#.#
#.......#.
#...#.....
.#...#....
#.#.......
#...#.....
..#...#..#
...##.#..#

Tile 2887:
#.#..#...#
.#...##.#.
#......#.#
#.....##.#
#.....##.#
#........#
..........
....#...##
.....#.#..
#...#.##.#

Tile 3917:
#....#.#.#
.##..##.#.
##....##..
#.##.....#
....#.....
#...#.#...
........##
##...#....
..........
##..#.#...

Tile 3761:
...#.##.##
.....##..#
#.....##.#
...#..#..#
####...##.
.........#
#.#..#....
#######.##
#......#..
..##......

Tile 1511:
##.#.##.##
....#....#
..##....##
##.##..#..
....###.#.
#..###...#
.#........
#..#.#....
....#.....
.###.#.##.

Tile 3023:
.#.###.#..
.....#...#
.......#..
.#..#....#
....###..#
###.#..###
..........
#.........
#.....#..#
..###.#.##

Tile 3221:
.......##.
##..#.#..#
...#......
#.........
#...#.#...
#..#.#...#
.###....#.
.#..#..#.#
.###.#..#.
###.##....

Tile 1009:
.#.#....##
.#...#....
..#.##...#
..##...##.
#..#......
...####..#
..........
.#.###.#..
...##....#
...#######

Tile 1931:
..##.#####
.....#....
#..##.....
#.#.....##
#####..#..
.....#....
.#........
#.......#.
#.....#...
##..##....

Tile 1783:
#..##.####
....#..#.#
...#...#..
......#...
...##.....
...##....#
#...##..#.
##..##....
...#...#..
#..#.#.#..

Tile 1129:
..#.#..###
##........
.#..#.#.##
....##...#
.......#.#
#.#.###...
.....#..##
..#..#....
#.#.....##
..#..#.###

Tile 1051:
.######.##
.#..#...##
.#....####
.......#.#
.....#..#.
......#...
#...#.##..
.##.......
#.........
..###.#..#

Tile 1693:
.##.##.###
..........
.....#....
#....#.#..
#.....#...
#...#.##.#
#.#..#...#
#.#.#.#..#
.##.......
..##.##..#

Tile 3719:
...##..#..
#...#.....
...#.#..##
.#..##...#
.....#..#.
#.........
...#.#.##.
...#..#..#
......##..
.#.....##.

Tile 1493:
##..#...##
....#..#.#
#..#....#.
#.##.#.###
###.#.#...
.###.#...#
#..#.#..#.
.....##...
#.#...#..#
...#..###.

Tile 1013:
.##.###.##
..........
....#..#.#
........##
....#..#..
#.##.##.#.
#.........
#.##..##.#
#......#..
.#####..#.

Tile 2087:
...######.
#...###.##
#.#.......
..........
#.....#.#.
..#..#...#
.....#...#
#....#....
.#...#.##.
....#.##.#

Tile 1201:
##...#..#.
.....#..##
.........#
..#...#...
.....#.###
#..#..#...
.....#.#.#
.#........
#...##..#.
..#.#.##.#

Tile 1877:
...###..#.
#..###...#
...#...#.#
#......###
.#........
#.......#.
#.........
.#..#....#
#.#..##..#
##.#.###..

Tile 3697:
..#..#....
.........#
#..#.#....
#.##..#..#
.##..#.#.#
...#..#..#
.......#..
..##.....#
#........#
#.##..#...

Tile 1187:
#...####.#
#........#
...#..#.##
.........#
#........#
#..#..#..#
.........#
##.....##.
#.#....#.#
.##.#...#.

Tile 1303:
##..##.##.
..........
#.....#...
...##....#
....#.....
.###.#....
....##....
.#..#...##
#....#...#
.#..#..###

Tile 3109:
..##....#.
..#.#....#
....#..#..
...##.#...
#...#..#..
..#..#...#
.......#.#
#..#.###..
..#.....#.
####...##.

Tile 1553:
.#.#####..
#...##....
..#....#..
#....#.#..
#..#....#.
#.#.#.##.#
...##...##
#.....#..#
.........#
.##.#.##.#

Tile 2797:
.#.##...##
#.......##
##...#...#
####.#....
##.##...##
.....#....
.....#....
##..#...#.
...#....#.
##.##..###

Tile 3301:
###...##..
#.......#.
....#...#.
###.##.#.#
..##...###
#.....#...
##.......#
.#........
...#.....#
#.###..#.#

Tile 2707:
#.#.##...#
..###.....
..........
..#.#.#..#
..#....##.
.......#..
......#..#
.#..#.....
.#.....#.#
.#........

Tile 1409:
#..#..#.#.
#..#..#..#
.........#
......#..#
####..#.##
##..#..#.#
..#.#....#
.#......##
..#.#.#..#
#.###..#.#

Tile 1297:
..##..##.#
...#.##...
...#####..
....##...#
#.......#.
.#..#.....
#.#.#....#
..#.......
###.......
.#..###...

Tile 2729:
..##.##.#.
#...#.#.##
#..#.#.##.
###...##..
#.#....#.#
........##
#........#
#...#..###
.#....#...
.#...#.#..

Tile 3359:
##...#.#..
...#......
...#..#..#
##.......#
.......###
#...##.#.#
##.#..##..
.#....#..#
.....#....
.#.##.#..#

Tile 1321:
..####..#.
#..##...#.
.........#
.........#
##..#.##..
###..##.#.
...#.....#
.#....#..#
#..#.##..#
###...#...

Tile 1307:
......#.##
...#.#..##
###.#.#...
..#...##.#
#..#...#..
........#.
#...#..##.
#.....####
...#.....#
###..###.#

Tile 1949:
.#.####..#
#..##...#.
#......#..
..........
#...##....
#.####..#.
#.....#...
......##.#
#...#...##
....#.#.##

Tile 3637:
..#######.
#....#.#..
#.....#..#
..#.......
........#.
.#......#.
#.....#..#
..##..#...
.#...#....
#.#.....##

Tile 1601:
##..##....
.##......#
........##
#.........
#.#.......
##.#......
..#.#....#
..........
##...#.#..
.#..#..#..

Tile 3389:
.###.#..##
#.......##
.#......#.
..###.....
....#....#
........##
#...#....#
.......#..
...#......
#.####....

Tile 3253:
##.###.#..
#.#.....##
#.........
..........
...#.....#
#........#
..#....#.#
#..#......
....#....#
.#...#.###

Tile 1933:
.#..#.#.##
........#.
..#..#....
.....#...#
.......#..
#.#..##..#
.........#
..#..#..#.
#.#......#
###..###..

Tile 3463:
......#...
###......#
...#.#....
..#..##.#.
##....#...
#..#...#..
.#....#.#.
###...####
#..#.#.#..
###..#....

Tile 1279:
.##..#..##
##.....#.#
....#.....
..#......#
#.#.#.....
.....#....
..##......
#.....##.#
...#...#..
###..###.#

Tile 3793:
...#..##.#
....#.##..
..##....##
........##
.....#....
........##
......#...
.........#
#.........
###..#.###

Tile 2671:
##.#.#.#.#
#.##..#..#
#.##..###.
.........#
#..#.#....
....##..#.
....##.#..
.#.#......
....#..#.#
.##.####.#
"""

function gettiles()
    tiledict, tilenum, mat, row = Dict(), 0, zeros(Bool, 10, 10), 0
    for line in split(input, "\n")
        if (m = match(r"Tile\s+(\d+)", line)) != nothing
            tilenum = parse(Int, m.captures[1])
            mat .= false
            row = 1
        elseif length(line) > 9
            mat[row, :] .= [c =='#' for c in strip(line)]
            if(row += 1) > 10
                tiledict[tilenum] = deepcopy(mat)
            end
        end
    end
    return tiledict
end

const tiledict = gettiles()
const dim = isqrt(length(tiledict))
const nullmat = zeros(Int, 10, 10)
const tilefield = fill(Pair(0, nullmat), 2 * dim + 1, 2 * dim + 1)

isinfield(field, tilenum) = any(x -> x[1] == tilenum, field)
nop(mat) = mat
rev(mat) = reverse(mat, dims=1)
over(m1, m2) = m1[end, :] == m2[1, :]
under(m1, m2) = over(m2, m1)
l2r(m1, m2) = m1[:, end] == m2[:, 1]
r2l(m1, m2) = l2r(m2, m1)

function allmatches(mat1, mat2)
    ret = []
    for f1 in [nop, rotr90, rot180, rotl90], f2 in [nop, rev], pos in [over, under, l2r, r2l]
        mat3 = f1(f2(mat2))
        if pos(mat1, mat3)
            push!(ret, (pos, mat3))
        end
    end
    return ret
end

function trytile(field)
    if all(x -> x[1] == 0, field)
        newfield = deepcopy(field)
        tile = first(tiledict)
        newfield[dim + 1, dim + 1] = Pair(tile[1], tile[2])
        return trytile(newfield)
    end
    xmax, ymax = size(field)
    for x in 1:xmax, y in 1:ymax
        entry = field[x, y]
        entry[1] == 0 && continue
        for p in tiledict
            p[1] == entry[1] && continue
            matches = allmatches(entry[2], p[2])
            for (d, mat3) in matches
                delta = d == over ? [1, 0] : d == under ? [-1, 0] : d == l2r ? [0, 1] : [0, -1]
                x2, y2 = [x, y] .+ delta
                (1 <= x2 <= xmax && 1 <= y2 <= ymax) || continue
                field[x2, y2][1] != 0 && continue
                newfield = deepcopy(field)
                newfield[x2, y2] = Pair(p[1], mat3)
                placedcount = count(x -> x[1] != 0, newfield)
                if placedcount == length(tiledict)
                    println("Done, placed $placedcount.")
                    return true, newfield
                else
                    println("Placed count is $placedcount")
                end
                for nexttile in tiledict
                    success, fld = trytile(newfield)
                    success && return true, fld
                end
                return false, newfield
            end
        end
    end
    return false, field
end

function matchtiles()
    success, field = return trytile(tilefield)
    if success
        println(field[13:end, 13:end])
    else
        println("no solution found")
    end
    return field
end

const corners = Int[]
for p1 in tiledict
    psum = 0
    for p2 in tiledict
        p2[1] == p1[1] && continue
        matches = allmatches(p1[2], p2[2])
        psum += length(matches)
    end
    if psum == 2
        println("Tile ", p1[1], " matches ", psum)
        push!(corners, p1[1])
    end
end

println("Corners $corners, prod ", prod(corners))

const newfield = matchtiles()
const cinput =  """
                 #  
#    ##    ##    ###
 #  #  #  #  #  #   
"""
const seamonster = reshape(collect(cinput[1:20] * cinput[22:41] * cinput[43:62), 3, 20)

function part2(field)
    xm, ym = size(field)
    leastx, leasty = 0, 0
    for x in 1:xm, y in 1:ym
        if field[x, y][1] != 0
            leastx, leasty = x, y
            break
        end
    end
    trimfield = zeros(Bool, 9 * dim, 9 * dim)
    for i in leastx:leastx+dim, j in leasty:leasty+dim
        trimfield[9i-8:9i, 9j-8:9j] .= field[i, j][2][2:end-1, 2:end-1]
    end
    for rot in (nop, rotr90, rot180, rotl90), flip in (nop, rev)
        newmap = rot(flip(trimfield))
        width = height = dim * 9
        locations = []
        for i in 1:height-3, j in 1:width-20
            if trimfield[i:i+3, j:j+20] .== seamonster
                println("seamonster at $i, $j")
                push!(locations, [i, j])
            end
        end
    end
    for loc in locations
        trimfield[loc[1]:loc[1]+3, loc[2]:loc[2]+20] .= false
    end
    return sum(trimfield)
end

